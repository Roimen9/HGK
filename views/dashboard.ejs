<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<body class="bg-body-tertiary">
    <%- include('./partials/user-header') %>
    <div class="container mt-md-5 mt-1 pt-5">
        <div class="box mt-5 pt-5">
            <div class="feedback lead fs-5 ms-lg-5"></div>
            <input type="text" class="id" value="<%= user.id %>" style="display: none;">
            <div class="row align-items-center justify-content-center gap-5">
                <h3 class="name ms-lg-5 ps-lg-5">Welcome back <%= user.name %></h3>
                <div class="card col-lg-3 col-md-5 col-10 p-2 rounded-4 shadow border border-dark-subtle border-1">
                    <h3 class="card-title text-center">Saved By</h3>
                    <h4 class="fs-4 p-3 text-center"><%= number %> <%= number > 1 ? 'users' : 'user' %></h4>
                </div>
                <div class="card col-lg-6 col-md-5 col-10 p-2 rounded-4 shadow border border-dark-subtle border-1 d-flex flex-lg-row align-items-center gap-3">
                    <textarea class="form-control shadow-none outline-none location offer fs-5" placeholder="Enter offer" rows="4" style="resize: none;"></textarea>
                    <div class="submit btn btn-dark rounded-pill p-2 fs-5">Submit</div> 
                </div>
            </div>
        </div>
    </div>
</body>
    <script>
        const info = document.querySelector('.feedback')
        const input = document.querySelector('.offer')
        const button = document.querySelector('.submit')
        const id = document.querySelector('.id').value

        async function submit() {
            const offer = {
                offer : input.value
            }
            const options = {
                method : 'POST',
                headers : {
                    'Content-type' : 'application/json'
                },
                body : JSON.stringify(offer)
            }
            try {
                const response = await fetch(`/restaurant/offer/${id}`,
                options)
                if(!response.ok) throw new Error('Internal server error')
                    const data = await response.json()
                    info.style.color = 'green'
                    info.textContent = data
                    setTimeout(() => {
                        info.textContent = ""
                        input.value = ""
                    }, 2500);
            } catch (error) {
                console.log('Error', error)
                info.style.color = 'red'
                info.textContent = 'Failed to update the offer try again later'
                setTimeout(() => {
                    info.textContent = ""
                    input.value = ""
                }, 2500);

            }
        }
        button.onclick = submit
    </script>
</html>