<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Restaurant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<body class="bg-body-light">
  <%- include('../partials/admin-header') %>
    <div class="container mt-5 mb-5 p-5">
        <h3 class="text fs-2 mt-3">New Restaurant</h3>
        <div class="my-1 fs-4 lead feedback"></div>
        <form class="mt-2 border border-1 px-5 pt-5 pb-0 rounded-4 shadow-sm">
            <div class="row mb-4">
              <div class="form-group col-3">
                <label class="fs-5">Name</label>
                <input class="form-control shadow-none outline-none name" placeholder="Name">
              </div>
              <div class="form-group col-3">
                <label class="fs-5">Vibe</label>
                <input class="form-control shadow-none vibe" placeholder="Vibe">
              </div>
              <div class="form-group col-3">
                <label class="fs-5">Menu 1</label>
                <input type="file" class="form-control shadow-none" placeholder="Menu 1" id="menu1">
              </div>
              <div class="form-group col-3">
                <label class="fs-5">Image 1</label>
                <input type="file" class="form-control shadow-none" placeholder="Image 1" id="image1">
              </div>
            </div>
            <div class="row mb-4">
                <div class="form-group col-3">
                  <label class="fs-5">Number</label>
                  <input class="form-control shadow-none outline-none number" placeholder="Number">
                </div>
                <div class="form-group col-3">
                  <label class="fs-5">Category</label>
                  <input class="form-control shadow-none category" placeholder="Category">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Menu 2</label>
                    <input type="file" class="form-control shadow-none" placeholder="Menu 2" id="menu2">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Image 2</label>
                    <input type="file" class="form-control shadow-none" placeholder="Image 2" id="image2">
                </div>
              </div>
              <div class="row mb-4">
                <div class="form-group col-3">
                  <label class="fs-5">Email</label>
                  <input class="form-control shadow-none outline-none email" placeholder="Email">
                </div>
                <div class="form-group col-3">
                  <label class="fs-5">Cuisine</label>
                  <input class="form-control shadow-none cuisine" placeholder="Cuisine">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Menu 3</label>
                    <input type="file" class="form-control shadow-none" placeholder="Menu 3" id="menu3">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Image 3</label>
                    <input type="file" class="form-control shadow-none" placeholder="Image 3" id="image3">
                </div>
              </div>
              <div class="row mb-4">
                <div class="form-group col-3">
                  <label class="fs-5">Instagram</label>
                  <input class="form-control shadow-none outline-none instagram" placeholder="Instagram">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Location</label>
                    <input class="form-control shadow-none outline-none location" placeholder="Location">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Menu 4</label>
                    <input type="file" class="form-control shadow-none" placeholder="Menu 4" id="menu4">
                </div>
                <div class="form-group col-3">
                    <label class="fs-5">Image 4</label>
                    <input type="file" class="form-control shadow-none" placeholder="Image 4" id="image4">
                </div>
              </div>
              <div class="row align-items-center">
                  <div class="form-group col-6">
                      <label class="fs-5">Description</label>
                      <textarea class="form-control shadow-none description" placeholder="Description" style="resize: none;"></textarea>
                    </div>
                    <div class="form-group col-3">
                        <label class="fs-5">Menu 5</label>
                        <input type="file" class="form-control shadow-none" placeholder="Menu 5" id="menu5">
                    </div>
                    <div class="form-group col-3">
                        <label class="fs-5">Image 5</label>
                        <input type="file" class="form-control shadow-none" placeholder="Image 5" id="image5">
                    </div>
              </div>
                <div class="row my-4 d-flex justify-content-center gap-3">
                    <div class="col-2 btn btn-dark fs-5 rounded-pill p-2 submit">Submit</div>
                    <a href="#" class="col-2 btn btn-danger fs-5 rounded-pill p-2 cancel">Cancel</a>
                </div>
          </form>
    </div>
</body>
    <script>
      const submit = document.querySelector('.submit')
      const info = document.querySelector('.feedback')

      async function send() {
        const length = 10
        const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#%&*';
        let password = '';
        for (let i = 0; i < length; i++) {
            const randomIndex = Math.floor(Math.random() * chars.length);
            password += chars[randomIndex];
        }
        console.log(password)
        // const restaurant = {
        //     name : document.querySelector('.name').value,
        //     number : document.querySelector('.number').value,
        //     email : document.querySelector('.email').value,
        //     instagram : document.querySelector('.instagram').value,
        //     description : document.querySelector('.description').value,
        //     vibe : document.querySelector('.vibe').value,
        //     category : document.querySelector('.category').value,
        //     cuisine : document.querySelector('.cuisine').value,
        //     Location : document.querySelector('.location').value,
        //     password : password,
        //     offer : ''
        // }

        const form = new FormData()
        form.append('name', document.querySelector('.name').value)
        form.append('number', document.querySelector('.number').value)
        form.append('email', document.querySelector('.email').value)
        form.append('instagram', document.querySelector('.instagram').value)
        form.append('description', document.querySelector('.description').value)
        form.append('vibe', document.querySelector('.vibe').value)
        form.append('category', document.querySelector('.category').value)
        form.append('cuisine', document.querySelector('.cuisine').value)
        form.append('location', document.querySelector('.location').value)
        form.append('password', password)

        const ids = ['image1', 'image2', 'image3', 'image4', 'image5', 'menu1', 'menu2', 'menu3', 'menu4', 'menu5']
        ids.forEach(id => {
          const file = document.getElementById(id)
          console.log(file.files)
          if(file.files.length > 0) {
            form.append(id, file.files[0])
          }
        })

        const options = {
          method : 'POST',
          body : form
        }

        try {
          const response = await fetch('/admin/add', options)
          if (!response.ok) throw new Error('Internal server error')
          const data = await response.json()
          console.log(data)
            info.style.color = 'green'
            info.textContent = data
            // setTimeout(() => {
            //   location.assign('/')
            // }, 3000);
        } catch (error) {
          console.log('Error', error)
          info.style.color = 'red'
          info.textContent = 'There was a problem inserting the data in the database'
        }
      }
      
      submit.onclick = send
    </script>
</html>